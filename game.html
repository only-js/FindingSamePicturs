<!DOCTYPE  html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="style.css" />

</head>
<body>
    <div id="header">
        <input id="start" type="button" value="Start Game">
        HidingTime : <input id="time" type="text" value="4">
        Moves : <span id="move"></span> 
        Completed : <span id="complete"></span> / 8
    </div>
    <div id="main">

    </div>




    <script>

    document.getElementById("start").onclick = start;
    var movements = 0;
    var move = document.getElementById("move");
    move.innerHTML = movements;
    var completed = 0;
    var complete = document.getElementById("complete");
    complete.innerHTML = completed;
    var hiddenImage;
    var seenTime = Number(document.getElementById("time").value)*1000;    //The time before hiding images
    var flag = 0;
    var elementHolder1;
    var elementHolder2;
    
    function start() {
        movements = 0;
        move.innerHTML = movements;

        completed = 0;
        complete.innerHTML = completed;

        seenTime = Number(document.getElementById("time").value)*1000;
        flag = 0;
        setOrder();
        window.clearTimeout(hiddenImage);
        resetOpacity(); //If you push start button more than 1 , you need to reset opacity. otherwise all images will be hidden!!
        loadImages();
        addClick();
    }

        
    


    //Make elements of game
    var main = document.getElementById("main");

    for(var i=0 ; i<16 ; i++){
        main.innerHTML += '<div class="part"><div class="item"></div></div>';
    }

    var items = document.getElementsByClassName("item");

    //Address of images
    var images =["1.jpeg", "2.jpeg", "3.jpeg", "4.jpeg", "5.jpeg", "6.jpeg", "7.jpeg","8.jpeg",
                 "9.jpeg", "10.jpeg", "11.jpeg", "12.jpeg", "13.jpeg", "14.jpeg", "15.jpeg", "16.jpeg"];
    var order = [0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7];

    //Randomize order of Images
    //Randomize order in order array
    function setOrder(){

        var rand;
        var temp;

        for(i in images){
            for(j in images){
                if(i!=j){
                    rand = Math.random();
                    if(rand >= 0.5){
                        temp = images[i];
                        images[i] = images[j];
                        images[j] = temp;
                    }
                }
            }
        }

        for(i in order){
            for(j in order){
                if(i!=j){
                    rand = Math.random();
                    if(rand >= 0.5){
                        temp = order[i];
                        order[i] = order[j];
                        order[j] = temp;
                    }
                }
            }
        }
    }



    function loadImages(){
        for(var k=0 ; k<items.length ; k++){
            items[k].style.backgroundImage = "url('images/" + images[order[k]] + "')";
        }
        hiddenImage = setTimeout(function(){
            for(var k=0 ; k<items.length ; k++){
            items[k].style.opacity = "0";
        }
        }, seenTime);
    }


    function addClick(){
        for(var k=0 ; k<items.length ; k++){
            items[k].onclick = check;
        }
    }


    function resetOpacity(){
        for(var k=0 ; k<items.length ; k++){
            items[k].style.opacity = "1";
    }
    }

    function check(event){
        movements++;
        move.innerHTML = movements;

        if(flag == 0){
            elementHolder1 = event.target;
            elementHolder1.style.opacity = "1";
            flag = 1;
        }
        else if(flag == 1){
            elementHolder2 = event.target;
            elementHolder2.style.opacity = "1";
            if(elementHolder1.style.backgroundImage == elementHolder2.style.backgroundImage)
            {
                elementHolder1.onclick = "";
                elementHolder2.onclick = "";
                completed++;
                complete.innerHTML = completed;
                if(completed == 8){
                    alert("You win!")
                }
                console.log("ok");
                flag = 0;
            }
            else {
                console.log("no");
                flag = 0;
                setTimeout(function(){
                    elementHolder1.style.opacity = "0";
                    elementHolder2.style.opacity = "0";
                }, 300);
            }
        }
    }

    </script>
    
</body>
</html>